<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="TEMP.CommonDaoImpl">
    <!-- 新增附件信息表 -->
    <insert id="saveAttach" parameterClass="com.nstc.temp.model.Attach">
        <selectKey resultClass="java.lang.Integer" keyProperty="attachId">
            SELECT SEQ_G_ATTACH.NEXTVAL AS attachId FROM DUAL
        </selectKey>
        INSERT INTO G_ATTACH (
            ATTACH_ID,
            ATTACH_NAME,
            FILE_PATH,
            ATT_NO,
            IS_DELETE,
            CLTNO,
            CLTNAME,
            CREATE_TIME,
            CREATE_PERSON
        ) VALUES(
            #attachId#,
            #attachName#,
            #filePath#,
            #attNo#,
            #isDelete#,
            #cltno#,
            #cltname#,
            #createTime#,
            #createPerson#
        )
    </insert>

    <!-- 保存或修改附件信息表集合 -->  
    <update id="saveOrUpdateAttach" parameterClass="com.nstc.temp.model.Attach">
        MERGE INTO G_ATTACH T
        USING DUAL
            ON (T.ATTACH_ID = #attachId#)
        WHEN MATCHED THEN
        UPDATE
            SET
            T.ATTACH_NAME = #attachName#,
            T.FILE_PATH = #filePath#,
            T.ATT_NO = #attNo#,
            T.IS_DELETE = #isDelete#,
            T.CLTNO = #cltno#,
            T.CLTNAME = #cltname#,
            T.CREATE_TIME = #createTime#,
            T.CREATE_PERSON = #createPerson#
        WHEN NOT MATCHED THEN
            INSERT (
                ATTACH_ID,
                ATTACH_NAME,
                FILE_PATH,
                ATT_NO,
                IS_DELETE,
                CLTNO,
                CLTNAME,
                CREATE_TIME,
                CREATE_PERSON
            ) 
            VALUES (
                SEQ_G_ATTACH.NEXTVAL,
                #attachName#,
                #filePath#,
                #attNo#,
                #isDelete#,
                #cltno#,
                #cltname#,
                #createTime#,
                #createPerson#
            )
    </update>
</sqlMap>
