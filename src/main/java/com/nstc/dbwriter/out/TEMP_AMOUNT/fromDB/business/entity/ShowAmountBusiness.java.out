package com.nstc.temp.business;

/**
 * 初始化账户表
 
 * <p>Title: ShowAmountBusiness.java</p>
 *
 * <p>Description: 初始化账户表</p>
 *
 * <p>Company: 北京九恒星科技股份有限公司</p>
 *
 * @author luhao
 * 
 * @since：2019-02-22 10:50:49
 *
 */
public class ShowAmountBusiness extends AbstractTEMPBusiness{
    
    private Map<String, Object> $common{appNoLow}_amount_form;
    
    /** 账户表主键 */
    private Integer amountId;

    @Override
    public void doExecute() throws Exception {
        initBuss();
        
        //id不为空表示从会带出数据，才会有附件。如果是新增那么不会有附件
        if ( amountId != null && !NumberConstant.I_ZERO.equals(id)) {
            //根据Id查看事务详细信息
            Amount model = getLocator().getAmountService().getAmountById(amountId);
            //TODO 设置特殊字段
            $common{appNoLow}_amount_form = BeanHelper.describe(model);
            
            //根据事务id查询到关联的附件fileList
            CommonFileScope scope = new CommonFileScope();
            scope.setBussId(CastUtil.toNotNullString(id));
            scope.setType(CommonFileTypeEnum.AFFAIR_APPLY.getCode());
            List<CommonFile> fileList = getLocator().getCommonService().queryCommonFile(scope);
            
            //组装下载附件所需的数据
            String backUrl = "TPS-Web@tps_affair_apply.sf?m=" + super.getPageModel("v") + "&id=" + id;
            Map<String, Object> updloadFile = super.buildCommonFileMap(fileList, null, backUrl);
            $common{appNoLow}_amount_form.put("uploadFile", updloadFile);
        }
        
        putResult("$common{appNoLow}_amount_form", $common{appNoLow}_amount_form);
        
        // 组装其他数据
    }
    
    /**
     * 初始化
     * @author luhao
     * @since：2019-02-22 10:50:49
     */
    public void init() {
        if ($common{appNoLow}_amount_form == null) {
            $common{appNoLow}_amount_form = new HashMap<String, Object>(16);
        }
    }

}
